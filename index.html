<!DOCTYPE html>
<html>
<head>
    <title>God Mode Setup</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        body { font-family: sans-serif; background: #0f172a; color: white; display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; }
        .box { background: #1e293b; padding: 2rem; border-radius: 8px; width: 100%; max-width: 350px; border: 1px solid #334155; box-shadow: 0 10px 25px rgba(0,0,0,0.5); }
        input { width: 100%; padding: 12px; margin: 10px 0; background: #020617; border: 1px solid #475569; color: white; border-radius: 4px; box-sizing: border-box; }
        button { width: 100%; padding: 12px; background: #3b82f6; border: none; color: white; font-weight: bold; cursor: pointer; border-radius: 4px; transition: 0.3s; }
        button:hover { background: #2563eb; }
        #log { font-size: 13px; margin-top: 15px; color: #94a3b8; word-wrap: break-word; text-align: center; line-height: 1.4; }
    </style>
</head>
<body>
    <div class="box">
        <h3 style="margin-top:0; color:#3b82f6;">Super Admin Init</h3>
        <input type="email" id="email" placeholder="Admin Email">
        <input type="password" id="password" placeholder="Password">
        <button onclick="initGod()">Initialize God Account</button>
        <div id="log">Ready for deployment...</div>
    </div>

    <script>
        const SB_URL = 'https://cpweugzlzupkybqcycsx.supabase.co';
        const SB_KEY = 'sb_publishable_uKTv-Rsh4d_1v8DILXcjfg_SQ_tYPZg';
        
        const _supabase = supabase.createClient(SB_URL, SB_KEY);

        async function initGod() {
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            const log = document.getElementById('log');

            if(!email || !password) {
                log.innerText = "Error: Email and password required.";
                log.style.color = "#f87171";
                return;
            }

            log.style.color = "#94a3b8";
            log.innerText = "Communicating with Supabase...";

            const { data, error } = await _supabase.auth.signUp({
                email: email,
                password: password,
                options: {
                    // This metadata is critical for our SQL Trigger
                    data: { system_role: 'super_admin' },
                    // Point this to your dashboard file
                    emailRedirectTo: window.location.origin + '/dashboard.html'
                }
            });

            if (error) {
                log.style.color = "#f87171";
                // Check if user already exists
                if (error.status === 400 || error.message.includes("already registered")) {
                    log.innerText = "Account already exists! Try logging in or resetting your password.";
                } else {
                    log.innerText = "Error: " + error.message;
                }
            } else if (data.user) {
                log.style.color = "#4ade80";
                
                // Final Check: Did the user actually get created?
                if (data.session === null) {
                    log.innerHTML = "<b>Success!</b> Account created.<br>Since Email Confirmation is ON in your settings, check your inbox to activate God Mode.";
                } else {
                    log.innerText = "Success! God Account active. Redirecting...";
                    setTimeout(() => { window.location.href = 'dashboard.html'; }, 2000);
                }
            }
        }
    </script>
</body>
</html>
